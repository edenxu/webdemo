<!DOCTYPE html>
<html lang="en">

<head>

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="author" content="">

<title>营销业务分析及数据转换平台</title>

<!-- Bootstrap Core CSS -->
<link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

<!-- MetisMenu CSS -->
<link href="vendor/metisMenu/metisMenu.min.css" rel="stylesheet">

<!-- Custom CSS -->
<link href="dist/css/sb-admin-2.css" rel="stylesheet">

<!-- Morris Charts CSS -->
<link href="vendor/morrisjs/morris.css" rel="stylesheet">

<!-- Custom Fonts -->
<link href="vendor/font-awesome/css/font-awesome.min.css"
	rel="stylesheet" type="text/css">
<link rel="stylesheet" href="css/bootstrap-table.min.css">
<link rel="stylesheet" href="css/myApp.css" />


<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>

	<div id="wrapper">
		<!-- Navigation -->
		<nav class="navbar navbar-default navbar-static-top" role="navigation"
			style="margin-bottom: 0">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse"
					data-target=".navbar-collapse">
					<span class="sr-only">Toggle navigation</span> <span
						class="icon-bar"></span> <span class="icon-bar"></span> <span
						class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="index.html">核心功能DEMO</a>
			</div>
			<!-- /.navbar-header -->

			<ul class="nav navbar-top-links navbar-right">
				<li class="dropdown"><a class="dropdown-toggle"
					data-toggle="dropdown" href="#"> <i
						class="fa fa-envelope fa-fw"></i> <i class="fa fa-caret-down"></i>
				</a>
					<ul class="dropdown-menu dropdown-messages">
						<li><a href="#">
								<div>
									<strong>John Smith</strong> <span class="pull-right text-muted">
										<em>Yesterday</em>
									</span>
								</div>
								<div>Lorem ipsum dolor sit amet, consectetur adipiscing
									elit. Pellentesque eleifend...</div>
						</a></li>
						<li class="divider"></li>
						<li><a href="#">
								<div>
									<strong>John Smith</strong> <span class="pull-right text-muted">
										<em>Yesterday</em>
									</span>
								</div>
								<div>Lorem ipsum dolor sit amet, consectetur adipiscing
									elit. Pellentesque eleifend...</div>
						</a></li>
						<li class="divider"></li>
						<li><a href="#">
								<div>
									<strong>John Smith</strong> <span class="pull-right text-muted">
										<em>Yesterday</em>
									</span>
								</div>
								<div>Lorem ipsum dolor sit amet, consectetur adipiscing
									elit. Pellentesque eleifend...</div>
						</a></li>
						<li class="divider"></li>
						<li><a class="text-center" href="#"> <strong>Read
									All Messages</strong> <i class="fa fa-angle-right"></i>
						</a></li>
					</ul> <!-- /.dropdown-messages --></li>
				<!-- /.dropdown -->
				<li class="dropdown"><a class="dropdown-toggle"
					data-toggle="dropdown" href="#"> <i class="fa fa-tasks fa-fw"></i>
						<i class="fa fa-caret-down"></i>
				</a>
					<ul class="dropdown-menu dropdown-tasks">
						<li><a href="#">
								<div>
									<p>
										<strong>Task 1</strong> <span class="pull-right text-muted">40%
											Complete</span>
									</p>
									<div class="progress progress-striped active">
										<div class="progress-bar progress-bar-success"
											role="progressbar" aria-valuenow="40" aria-valuemin="0"
											aria-valuemax="100" style="width: 40%">
											<span class="sr-only">40% Complete (success)</span>
										</div>
									</div>
								</div>
						</a></li>
						<li class="divider"></li>
						<li><a href="#">
								<div>
									<p>
										<strong>Task 2</strong> <span class="pull-right text-muted">20%
											Complete</span>
									</p>
									<div class="progress progress-striped active">
										<div class="progress-bar progress-bar-info" role="progressbar"
											aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"
											style="width: 20%">
											<span class="sr-only">20% Complete</span>
										</div>
									</div>
								</div>
						</a></li>
						<li class="divider"></li>
						<li><a href="#">
								<div>
									<p>
										<strong>Task 3</strong> <span class="pull-right text-muted">60%
											Complete</span>
									</p>
									<div class="progress progress-striped active">
										<div class="progress-bar progress-bar-warning"
											role="progressbar" aria-valuenow="60" aria-valuemin="0"
											aria-valuemax="100" style="width: 60%">
											<span class="sr-only">60% Complete (warning)</span>
										</div>
									</div>
								</div>
						</a></li>
						<li class="divider"></li>
						<li><a href="#">
								<div>
									<p>
										<strong>Task 4</strong> <span class="pull-right text-muted">80%
											Complete</span>
									</p>
									<div class="progress progress-striped active">
										<div class="progress-bar progress-bar-danger"
											role="progressbar" aria-valuenow="80" aria-valuemin="0"
											aria-valuemax="100" style="width: 80%">
											<span class="sr-only">80% Complete (danger)</span>
										</div>
									</div>
								</div>
						</a></li>
						<li class="divider"></li>
						<li><a class="text-center" href="#"> <strong>See
									All Tasks</strong> <i class="fa fa-angle-right"></i>
						</a></li>
					</ul> <!-- /.dropdown-tasks --></li>
				<!-- /.dropdown -->
				<li class="dropdown"><a class="dropdown-toggle"
					data-toggle="dropdown" href="#"> <i class="fa fa-bell fa-fw"></i>
						<i class="fa fa-caret-down"></i>
				</a>
					<ul class="dropdown-menu dropdown-alerts">
						<li><a href="#">
								<div>
									<i class="fa fa-comment fa-fw"></i> New Comment <span
										class="pull-right text-muted small">4 minutes ago</span>
								</div>
						</a></li>
						<li class="divider"></li>
						<li><a href="#">
								<div>
									<i class="fa fa-twitter fa-fw"></i> 3 New Followers <span
										class="pull-right text-muted small">12 minutes ago</span>
								</div>
						</a></li>
						<li class="divider"></li>
						<li><a href="#">
								<div>
									<i class="fa fa-envelope fa-fw"></i> Message Sent <span
										class="pull-right text-muted small">4 minutes ago</span>
								</div>
						</a></li>
						<li class="divider"></li>
						<li><a href="#">
								<div>
									<i class="fa fa-tasks fa-fw"></i> New Task <span
										class="pull-right text-muted small">4 minutes ago</span>
								</div>
						</a></li>
						<li class="divider"></li>
						<li><a href="#">
								<div>
									<i class="fa fa-upload fa-fw"></i> Server Rebooted <span
										class="pull-right text-muted small">4 minutes ago</span>
								</div>
						</a></li>
						<li class="divider"></li>
						<li><a class="text-center" href="#"> <strong>See
									All Alerts</strong> <i class="fa fa-angle-right"></i>
						</a></li>
					</ul> <!-- /.dropdown-alerts --></li>
				<!-- /.dropdown -->
				<li class="dropdown"><a class="dropdown-toggle"
					data-toggle="dropdown" href="#"> <i class="fa fa-user fa-fw"></i>
						<i class="fa fa-caret-down"></i>
				</a>
					<ul class="dropdown-menu dropdown-user">
						<li><a href="#"><i class="fa fa-user fa-fw"></i> User
								Profile</a></li>
						<li><a href="#"><i class="fa fa-gear fa-fw"></i> Settings</a>
						</li>
						<li class="divider"></li>
						<li><a href="login.html"><i class="fa fa-sign-out fa-fw"></i>
								Logout</a></li>
					</ul> <!-- /.dropdown-user --></li>
				<!-- /.dropdown -->
			</ul>
			<!-- /.navbar-top-links -->
			<!-- 树状侧边栏菜单 -->
			<div class="navbar-default sidebar" role="navigation">
				<div class="sidebar-nav navbar-collapse">
					<ul class="nav" id="side-menu">
						<li class="sidebar-search">
							<div class="input-group custom-search-form">
								<input id="input-select-node" type="text" class="form-control"
									placeholder="Search..."> <span class="input-group-btn">
									<button class="btn btn-default" type="button">
										<i class="fa fa-search"></i>
									</button>
								</span>
							</div> <!-- /input-group -->
						</li>
						<div id="treeview1" style="height:690px; overflow:auto"></div>
					</ul>
				</div>
				<!-- /.sidebar-collapse -->

			</div>
			<!-- /.navbar-static-side -->
		</nav>

		<div id="page-wrapper">
			<div class="row">
				<div class="col-lg-12">
					<h5>查询字段列表：</h5>
					<div class="panel panel-default">
						<div id="queryfields" class="panel-heading searchColumn">
							<ul id="sortablefield">
								<!-- 侧边栏双击选择的字段将被动态添加到这里 -->
							</ul>
						</div>
					</div>
				</div>
				<div class="col-lg-12">
					<div class="panel panel-default whereConditionPanel">
						<div class="whereCondition">
							<p>
								筛选条件：
								<button type="button" class="btn btn-primary btn-sm"
									onclick="addWhereClause()">
									<span class="glyphicon glyphicon-plus"> 添 加 </span>
								</button>
								<button type="button" class="btn btn-primary btn-sm"
									id="searchButton">
									<span class="glyphicon glyphicon-search" onClick="goSearch()">
										查 询 </span>
								</button>
							</p>
							</br>
							<div class="whereArea" id="whereArea"></div>
						</div>
					</div>
				</div>
				<!-- /.col-lg-12 -->
			</div>
			<!-- 数据表 -->
			<div class="row">
				<div class="col-lg-12">
					<div class="panel panel-default resultPanel">
						<div class="panel-heading">统计结果</div>
						<!-- /.panel-heading -->
						<div class="panel-body" style="overflow:auto">
							<!-- |-toolbar -->
							<!--
							<div id="toolbar" class="btn-group">
								<button type=button class="btn btn-primary"
									onclick="exportdata()">导出</button>
							</div>
							-->
							<!-- toolbar-| -->
							<table width="100%"
								class="table table-striped table-bordered table-hover"
								id="dataTable">
							</table>
							<!-- /.table -->
						</div>
						<!-- /.panel-body -->
					</div>
					<!-- /.panel -->
				</div>
				<!-- /.col-lg-12 -->
			</div>
			<!-- /.row -->
		</div>
		<!-- /#page-wrapper -->

	</div>
	<!-- /#wrapper -->

	<!-- jQuery -->
	<script src="js/jquery-3.3.1.min.js"></script>

	<!-- Bootstrap Core JavaScript -->
	<script src="vendor/bootstrap/js/bootstrap.min.js"></script>

	<!-- Metis Menu Plugin JavaScript -->
	<script src="vendor/metisMenu/metisMenu.min.js"></script>

	<script src="js/bootstrap-table.js"></script>
	<script src="js/bootstrap-table-export.js"></script>
	<script src="js/tableExport.js"></script>
	<script src="js/bootstrap-table-zh-CN.min.js">

	<!-- Custom Theme JavaScript -->
	<script src="dist/js/sb-admin-2.js"></script>
	<script src="vendor/bootstrap/js/bootstrap-treeview.min.js"></script>
	<script
		src="http://apps.bdimg.com/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>
	<script src="js/layer/layer.js"></script>
	<script src="js/myTool.js"></script>

	<script type="text/javascript">
	
		var defaultData = [];
		var $selectableTree;
		var selectArray = new Array();
		var optionString = '<select class="form-control"><option value=" > "> > </option><option value=" >= "> >= </option><option value=" = "> = </option>'
			+ '<option value=" < "> < </option><option value=" <= "> <= </option><option value=" IN "> IN </option><option value=" NOT IN "> NOT IN </option><option value=" LIKE "> LIKE </option></select>';
		var optionBefore = '<select class="form-control"><option value="">  </option><option value=" ( "> ( </option></select>';
		var optionAfter = '<select class="form-control"><option value="">  </option><option value=" ) "> ) </option></select>';
		var optionRela = '<select class="form-control"><option value="">  </option><option value=" AND "> AND </option><option value=" OR "> OR </option></select>';
		var deleteButton = '<button type="button" class="btn btn-warning" onClick="deleteCurrentRow(this)"><span class="glyphicon glyphicon-remove"> 删 除 </span></button>';
	
		var whereConditionSQL = '';
		var havingConditionSQL = '';
		var groupClauseSQL = '';
		var groupMode = 'N';
		// 当前数据表格加载的数据表名称
		var $dataTable = $('#dataTable');
		// 当前数据集展示的表名
		var table = "";
		// 当前数据集表头信息
		var columsArray = new Array();
	
		//侧边栏菜单树内容查找
		var findSelectableNodes = function() {
			return $selectableTree.treeview('search', [ $('#input-select-node').val(), {
				ignoreCase : false,
				exactMatch : false
			} ]);
		};
		//var selectableNodes = findSelectableNodes();
	
		// Select/unselect/toggle nodes
		$('#input-select-node').on('keyup', function(e) {
			if (e.keyCode != 13) {
				//只响应回车事件
				return;
			}
			selectableNodes = findSelectableNodes();
			$('.select-node').prop('disabled', !(selectableNodes.length >= 1));
	
			var expandedNodes = new Array();
			expandedNodes = $('#treeview1').treeview('getExpanded');
			console.log(expandedNodes)
			var nodeLength = $(expandedNodes).length;
			var targetnodeId = $(selectableNodes).attr("nodeId");
			var nodeCounts = 0;
			for (var i = 0; i < nodeLength; i++) {
				if (targetnodeId > $(expandedNodes[i]).attr("nodeId")) {
					nodeCounts += $(expandedNodes[0]).attr("nodes").length;
				}
				else
					break;
			}
			$("#treeview1").animate({
				scrollTop : (nodeCounts + i) * 35 - $("#treeview1").offset().top
			}, 100);
		});
	
		//侧边栏菜单树双击添加查询字段
		//最后一次触发节点Id
		var lastSelectedNodeId = null;
		//最后一次触发时间
		var lastSelectTime = null;
		//自定义业务方法
		function treeDblClickBusiness(data) {
			// 要是选中的不是叶子结点不予以处理
			if (data.zdbm == null) {
				return;
			}
			// 已经添加过的元素不允许重复加入
			if (selectArray.indexOf(data.ybzd) == -1) {
				selectArray.push(data.ybzd);
				let newNode = $('<li jhbz="' + data.jhbz + '" zdmc="' + data.zdmc + '" zdbm="' + data.zdbm + '" ybzd="' + data.ybzd + '" ybmc="' + data.ybmc + '" sjlx="' + data.sjlx + '" ondblclick="deleteSelectNode(this)" class="btn btn-primary btn-sm" style="margin:2px;">' + data.zdmc + '</li>');
				$("#sortablefield").append(newNode);
				if (selectArray.length > 0) {
					$('#queryfields').removeClass('searchColumn');
				} else {
					$('#queryfields').addClass('searchColumn');
				}
				return true;
			} else {
				layer.alert('该字段已添加.', {
					icon : 6,
					title : '温馨提示'
				});
				return false;
			}
		//$("#dataTables-example").children("thead").children("tr").append("<th>" + data.text + "</th>");
		}
	
		function clickNode(event, data) {
			if (lastSelectedNodeId && lastSelectTime) {
				var time = new Date().getTime();
				var t = time - lastSelectTime;
				if (lastSelectedNodeId == data.nodeId && t < 300) {
					treeDblClickBusiness(data);
				}
			}
			lastSelectedNodeId = data.nodeId;
			lastSelectTime = new Date().getTime();
		}
	
		//自定义双击事件
		function treeDblClickFun() {
			//节点选中时触发
			$('#treeview1').on('nodeSelected', function(event, data) {
				clickNode(event, data)
			});
			//节点取消选中时触发
			$('#treeview1').on('nodeUnselected', function(event, data) {
				clickNode(event, data)
			});
		}
	
		// 删除选中字段
		function deleteSelectNode(value) {
			let mapValue = $(value).attr("ybzd");
			// 从队列中删除已取消的字段
			selectArray.remove(mapValue);
			// 从DOM中删除对应字段内容
			value.remove();
			if (selectArray.length > 0) {
				$('#queryfields').removeClass('searchColumn');
			} else {
				$('#queryfields').addClass('searchColumn');
			}
		}
	
		$(document).ready(function() {
			$.ajax({
				url : 'getSjyByExample',
				type : 'POST', //GET
				async : true, //或false,是否异步
				data : {
					zdbm : '000',
				},
				timeout : 5000, //超时时间
				dataType : 'json', //返回的数据格式：json/xml/html/script/jsonp/text
				success : function(data, textStatus, jqXHR) {
					defaultData = "[" + JSON.stringify(data) + "]";
					//侧边栏菜单树内容查找
					var initSelectableTree = function() {
						return $('#treeview1').treeview({
							expandIcon : 'glyphicon glyphicon-chevron-right',
							collapseIcon : 'glyphicon glyphicon-chevron-down',
							nodeIcon : 'glyphicon',
							color : "#428bca",
							data : defaultData,
						});
					};
					$selectableTree = initSelectableTree();
					//页面加载后
					//加载侧边栏
					treeDblClickFun();
					//查询字段动态处理
					$("#sortablefield").sortable();
					$("#sortablefield").disableSelection();
				},
				error : function(xhr, textStatus) {
					console.log('错误')
					console.log(xhr)
					console.log(textStatus)
				},
				complete : function() {
					//console.log('Ajax处理结束');
				}
			});
		});
	
		// 提交查询处理按钮点击事件
		function goSearch() {
			whereConditionSQL = '';
			groupClauseSQL = '';
			havingConditionSQL = '';
			// 是否需要进行分组处理标志
			groupMode = 'N';
			let list = $('#sortablefield').children();
			if (list.length <= 0) {
				layer.alert('您尚未选择任何查询字段.');
				return;
			}
			// 参数对象封装
			let paramsObject = new Object();
			let selectTables = new Array();
			list.each(function(id, value) {
				let obj = new Object();
				obj.zdbm = $(value).attr('zdbm');
				obj.ybmc = $(value).attr('ybmc');
				obj.ybzd = $(value).attr('ybzd');
				obj.sjlx = $(value).attr('sjlx');
				selectTables.push(obj);
				// 拼装GroupBy条件的字段内容
				if ($(value).attr('jhbz') == 'N') {
					groupClauseSQL += $(value).attr('ybzd') + ',';
				} else {
					groupMode = 'Y';
				}
			});
	
			// 去掉最后多余的逗号
			groupClauseSQL = groupClauseSQL.substring(0, groupClauseSQL.length - 1);
			// console.log(selectTables);
			// 处理Where条件，将结果装载到whereConditionSQL
			dealWhereClause();
			//console.log("havingConditionSQL:" + havingConditionSQL);
			//console.log("groupMode:" + groupMode);
			paramsObject.selectTables = selectTables;
			paramsObject.whereClause = whereConditionSQL;
			paramsObject.havingClause = havingConditionSQL;
			paramsObject.groupClause = groupClauseSQL;
			paramsObject.groupFlag = groupMode;
	
			console.log(paramsObject);
			return;
			// 展示加载层
			layer.load();
			// 屏蔽查询按钮
			$("#searchButton").attr("disabled", true);
			$.ajax({
				url : 'dealSelectedSQL',
				type : 'POST', //GET
				contentType : 'application/json',
				async : true, //或false,是否异步
				data : JSON.stringify(paramsObject),
				//timeout : 5000, //超时时间
				dataType : 'json', //返回的数据格式：json/xml/html/script/jsonp/text
				success : function(data, textStatus, jqXHR) {
					console.log(data);
					var columns = data.columns;
					columsArray = [];
					// 给表头字段添加辅助属性
					for (var i = 0; i < columns.length; i++) {
						var obj = new Object();
						obj = columns[i];
						obj.sortable = true;
						obj.align = 'center';
						columsArray.push(obj);
					}
					table = data.tableName;
					// 初始化数据表格
					$dataTable.bootstrapTable('destroy');
					$dataTable.bootstrapTable({
						url : "getTableDataByTableName",
						dataType : "json",
						singleSelect : false,
						datalocale : "zh-US", //表格汉化
						search : false, //显示搜索框
						sidePagination : "server", //服务端处理分页
						//height : tableHeight(), //高度调整
						pagination : true, //是否分页
						pageSize : 20, //单页记录数
						pageList : [ 5, 10, 20, 50 ], //分页步进值
						sidePagination : "server", //服务端分页
						contentType : "application/x-www-form-urlencoded", //请求数据内容格式 默认是 application/json 自己根据格式自行服务端处理
						method : "post", //请求方式
						//searchAlign : "right", //查询框对齐方式
						queryParamsType : "limit", //查询参数组织方式
						queryParams : function getParams(params) {
							params.tableName = table;
							return params;
						},
						//searchOnEnterKey : true, //回车搜索
						//showRefresh : true, //刷新按钮
						//showColumns : true, //列选择按钮
						//buttonsAlign : "right", //按钮对齐方式
						toolbar : "#toolbar", //指定工具栏
						toolbarAlign : "right", //工具栏对齐方式
						columns : columsArray,
						onLoadSuccess : function() {
							// 关闭加载层
							layer.closeAll('loading');
							// 恢复统计按钮状态
							$("#searchButton").attr("disabled", false);
						},
						onLoadError : function() {
							// 关闭加载层
							layer.closeAll('loading');
							// 恢复统计按钮状态
							$("#searchButton").attr("disabled", false);
						}
					});
				},
				error : function(xhr, textStatus) {
					console.log('错误')
					console.log(xhr)
					console.log(textStatus)
				},
				complete : function() {
					// console.log('Ajax处理结束')
				}
			});
		}
	
		// 添加Where条件选择行
		function addWhereClause() {
			let list = $('#sortablefield').children();
			if (list.length <= 0) {
				layer.alert('您尚未选择任何查询字段.');
				return;
			}
			let whereClause = $('#whereArea');
			let innerHTML = '<div class="whereClauseColumn form-inline">';
	
			let temp = optionBefore + '<select class="form-control" onChange="refreshInputDataType(this)" ><option value="none">-----选择字段-----</option>';
			list.each(function(id, value) {
				temp += "<option value='" + $(value).attr('ybzd') + "." + $(value).attr('jhbz') + "." + $(value).attr('sjlx') + "' zdbm='" + $(value).attr('zdbm') + "'>" + $(value).attr('zdmc') + "</option>";
			});
			innerHTML += temp + '</select>' + optionString;
			let tempValue = "<input type=text class='form-control'/>";
			tempValue += optionAfter + optionRela + deleteButton;
			innerHTML += tempValue + '</div>';
			whereClause.append(innerHTML);
		}
	
		// 对SQL语句的Where和Having条件进行处理
		function dealWhereClause() {
			let list = $('#whereArea').children();
			// 遍历筛选区域的所有DOM，并提取相关属性
			list.each(function(id, value) {
				//console.log(value);
				let columnType = '',
					columnName = '',
					jhbz = '',
					swapString = '';
				$(value).children().each(function(id, value) {
					// 字段名称特殊处理
					if (id == 1) {
						// 获取字段名称
						columnName = $(value).val().substr(0, $(value).val().length - 4);
						// 获取字段类型，主要用于拼装SQL时对不同类型的字段进行处理[C:字符,N:数字,T:时间]
						columnType = $(value).val().substr($(value).val().length - 1, 1);
						// 聚合标志，判断该字段是否属于聚合类型的字段
						jhbz = $(value).val().substr($(value).val().length - 3, 1);
						//console.log("jhbz:" + jhbz);
						//whereConditionSQL += columnName;
						swapString = columnName;
					} else if (id == 3) {
						let tzbz = $(value).find("option:selected").attr("tzbz");
						console.log('tzbz:' + tzbz);
						// 拓展下拉字段需特殊处理
						if (tzbz == 'N') {
							if( (columnType == 'C' || columnType == 'T') ) {
								// whereConditionSQL = whereConditionSQL + '\'' + $(value).val() + '\'';
								swapString = swapString + '\'' + $(value).val() + '\'';
							} else {
								//whereConditionSQL += $(value).val();
								swapString += $(value).val();
							}
						} else {
							//去掉前面的操作符标志位
							//swapString = swapString.substtring(0,tempString.length - 1)
							//console.log("最后出现空格的地方：" + swapString.trim().lastIndexOf(' '));
							swapString = swapString.substring(0, swapString.trim().lastIndexOf(' '));
							// 因后台返回的数值为01,02,03样式的字符串，所以需要进行分割处理
							let dropDownValues = $(value).val().split(',');
							console.log('dropDownValues:' + dropDownValues);
							let arrayLength = dropDownValues.length;
							let tempString = ' IN (';
							for (let i = 0; i < arrayLength; i++) {
								if( (columnType == 'C' || columnType == 'T') ) {
									tempString += '\'' + dropDownValues[i] + '\',';
								} else {
									tempString += dropDownValues[i] + ',';
								}
							}
							tempString = tempString.substring(0, tempString.length - 1) + ')';
							swapString += tempString;
						}
					} else if (id != 6) {
						// whereConditionSQL += $(value).val();
						swapString += $(value).val();
					}
				}
				);
				// 根据当前条件是否为聚合字段，选择放入到Where部分还是Having部分
				if (jhbz != 'Y') {
					whereConditionSQL += swapString;
				} else {
					groupMode = 'Y';
					console.log('聚合字段:' + columnName);
					havingConditionSQL += swapString;
				}
			});
			//----处理多余的AND 和 OR
			let abc = whereConditionSQL.lastIndexOf(" ");
			var lengthIndex = whereConditionSQL.length - 1;
			//console.log("abc:" + abc + "，length:" + length);
			if (abc == lengthIndex) {
				whereConditionSQL = whereConditionSQL.substring(0, whereConditionSQL.length - 4);
			}
			abc = havingConditionSQL.lastIndexOf(" ");
			lengthIndex = havingConditionSQL.length - 1;
			//console.log("abc:" + abc + "，length:" + length);
			if (abc == lengthIndex) {
				havingConditionSQL = havingConditionSQL.substring(0, havingConditionSQL.length - 4);
			}
		//console.log('whereConditionSQL:' + whereConditionSQL);
		//console.log('havingConditionSQL:' + havingConditionSQL);
		}
	
		// 删除当前行的筛选条件
		function deleteCurrentRow(value) {
			$(value).parent().remove();
		}
	
		// 更新
		function refreshInputDataType(value) {
			let zdbm = $(value).find("option:selected").attr("zdbm");
			$.ajax({
				url : 'getColumnDropDownList',
				type : 'POST', //GET
				contentType : 'application/x-www-form-urlencoded',
				async : true, //或false,是否异步
				data : {
					zdbm : zdbm,
				},
				//timeout : 5000, //超时时间
				dataType : 'json', //返回的数据格式：json/xml/html/script/jsonp/text
				success : function(data, textStatus, jqXHR) {
					//console.log(data);
					if (data.result.length > 0) {
						//console.log($(value).parent());
						//console.log($(value).next().next());
						let selectOption = '<select class="form-control">';
						let optionString = '';
						// 下拉菜单拓展标志位
						let tzFlag = 'N';
						let newOptionValue = '';
						for (let i = 0; i < data.result.length; i++) {
							//console.log(data.result[i]);
							tzFlag = data.result[i].tzbz;
							newOptionValue = data.result[i].ybzd;
							optionString += '<option value="' + data.result[i].sjz + '" tzbz="' + data.result[i].tzbz + '">' + data.result[i].xsz + '</option>';
						}
						selectOption += optionString + '</select>';
						if (tzFlag == 'Y') {
							//console.log('该字段进行了拓展');
							// 将Option中的Value换成拓展以后的值
							let oldOptionValue = $(value).find("option:selected").attr("value");
							newOptionValue += oldOptionValue.substring(oldOptionValue.length - 4);
							$(value).find("option:selected").attr("value", newOptionValue);
						//console.log($(value).find("option:selected").attr("value"));
						}
						let replaceNode = $(value).next().next();
						$(replaceNode).before(selectOption);
						replaceNode.remove();
					} else {
						let replaceNode = $(value).next().next();
						let inputNode = "<input type=text class='form-control'/>";
						$(replaceNode).before(inputNode);
						replaceNode.remove();
					}
				}
			});
		}
	</script>
</body>

</html>
